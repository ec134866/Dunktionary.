{% extends 'base.html'%}
      
        {% block title %}
          <title> Train Maker </title>
        {% endblock %}
        
        {% block search %}
        <h1> Search </h1>
          <form method ="get" action="{% url 'search' %}">
              <label for= "name"> Dunk Name </label>
              <input type="text" id="name" placeholder="Search..." name = "name">
          </form>
        {% endblock %}

{% block content %}
  <main>
    <body>
        <div class= "container">
            <div class = "row">
                <div class = "col-sm-2">
                    <ul class="list-unstyled">
                        <br>
                        <h4 style= "font-size:1.5vw"><a href={% url 'passlib'%} class="text-dark text-decoration-none">Passes</a></h4>
                        <h4 style= "font-size:1.5vw"><a href={% url 'dunklib'%} class="text-dark text-decoration-none">Dunks</a></h4>
                            <br>
                            <h5 style= "color:dark-grey; font-size:1.25vw"> Other </h5>
                            <h6 style= "font-size:1vw"><a href={% url 'makeATrain'%} class="text-decoration-none" style= "color:#444444">Train Maker</a></h6>
                            <h6 style= "font-size:1vw"><a href={% url 'dunkTheory'%} class="text-decoration-none" style= "color:#444444">Dunk Theory</a></h6>
                    </ul>
                </div>
                <div class = "col-sm-6">
                      <br><br><br><br><br>
                    <h4>
                    {% if train %}
                        <ul>
                            {% for item in train %}
                            <li>{{ item }}</li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        {% if custom_train_names %}
                            <ul>
                                {% for name in custom_train_names %}
                                <li>{{ name }}</li>
                                {% endfor %}
                            </ul>
                        {% else %}
                            <p>No valid train could be generated.</p>
                        {% endif %}
                    {% endif %}                                  
                    </h4>
                    <div id="custom_train_text">
                    </div>
                    <br>
                    <h4>Total Score: {{ total_score|floatformat:2 }}</h4>
                    <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
                    <div id="chart" style="position: absolute; width: 500px; height: 500px; top: 0; left: 0;"></div>
                    <div id="question" style="position: absolute; width: 400px; height: 500px; top: 0; left: 520px;">
                        <h1 style="font-size: 50px; font-weight: bold; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; position: absolute; padding: 0; margin: 0; top: 50%; -webkit-transform: translate(0, -50%); transform: translate(0, -50%);"></h1>
                    </div>

                  </div>
                  <div class = "col-sm-4">
                          <br><br><br><br>
                          <form method="post" id='train'>
                            {% csrf_token %}
                            <div class="form-group row">
                                <label for="num_people" class="col-sm-6 col-form-label font-weight-bold" style="font-size: 14px;">Number of People:</label>
                                <div class="col-sm-6">
                                    <div class="input-group input-group-sm">
                                        <span id="num_people_display" class="form-control border-0" style="font-size: 14px;">{{ request.POST.num_people|default:'0' }}</span>
                                        <div class="input-group-append">
                                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="incrementNumber('num_people')">▲</button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="decrementNumber('num_people')">▼</button>
                                        </div>
                                    </div>
                                    <input type="hidden" id="num_people" name="num_people" value="{{ request.POST.num_people|default:'0' }}">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label for="level" class="col-sm-6 col-form-label font-weight-bold" style="font-size: 14px;">Level:</label>
                                <div class="col-sm-6">
                                    <div class="input-group input-group-sm">
                                        <span id="level_display" class="form-control border-0" style="font-size: 14px;">{{ request.POST.level|default:'0' }}</span>
                                        <div class="input-group-append">
                                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="incrementNumber('level')">▲</button>
                                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="decrementNumber('level')">▼</button>
                                        </div>
                                    </div>
                                    <input type="hidden" id="level" name="level" value="{{ request.POST.level|default:'0' }}">
                                </div>
                            </div>
                            <div id="HIDDEN_custom_train_text">
                                {% comment %} the script {% endcomment %}
                            </div>
                            <div class="form-group row">
                                <label class="col-sm-6 col-form-label font-weight-bold" style="font-size: 14px;">Custom Train:</label>
                                <div class="col-sm-6">
                                    <input type="checkbox" id="custom_train_checkbox" name="custom_train" value="1">
                                </div>
                            </div>
                            <br>
                            <input type="submit" value="Generate Train" class="btn btn-primary">
                        </form>
                                
                        <script>
                          function incrementNumber(inputId) {
                            var inputDisplayElement = document.getElementById(inputId + "_display");
                            var inputElement = document.getElementById(inputId);
                            var currentValue = parseInt(inputElement.value);
                            inputElement.value = currentValue + 1;
                            inputDisplayElement.innerText = currentValue + 1;
                        }
                    
                        function decrementNumber(inputId) {
                            var inputDisplayElement = document.getElementById(inputId + "_display");
                            var inputElement = document.getElementById(inputId);
                            var currentValue = parseInt(inputElement.value);
                            if (currentValue > 0) {
                                inputElement.value = currentValue - 1;
                                inputDisplayElement.innerText = currentValue - 1;
                            }
                        }

                        document.getElementById("custom_train_checkbox").addEventListener("change", function () {
                            var CustomTrainText = document.getElementById("custom_train_text");
                            var HIDDENCustomTrainText = document.getElementById("HIDDEN_custom_train_text");
                            var numPeople = parseInt(document.getElementById("num_people").value);
                            var trainForm = document.getElementById('train');
                        
                            if (this.checked) {
                                // CustomTrainText.innerHTML = "";
                                // HIDDENCustomTrainText.innerHTML = ""; 
                                for (var i = 1; i <= numPeople; i++) {
                                    var input = document.createElement("input");
                                    input.type = "text";
                                    input.name = "custom_train_" + i;
                        
                                    var div = document.createElement("div");
                                    div.appendChild(input);
                        
                                    CustomTrainText.appendChild(div);
                        
                                    var hiddenInput = document.createElement("input");
                                    hiddenInput.type = "hidden";
                                    hiddenInput.name = "hidden_custom_train_" + i;
                                    div = document.createElement("div");
                                    div.appendChild(hiddenInput);
                                    HIDDENCustomTrainText.appendChild(div);
                                }
                                CustomTrainText.style.display = "block";
                                HIDDENCustomTrainText.style.display = "none";
                            } else {
                                CustomTrainText.innerHTML = "";
                                HIDDENCustomTrainText.innerHTML = "";
                                CustomTrainText.style.display = "none";
                                HIDDENCustomTrainText.style.display = "none";
                            }
                        });

                        function copyTextToHiddenInputs() {
                            var numPeople = parseInt(document.getElementById("num_people").value);
                            for (var i = 1; i <= numPeople; i++) {
                                var customTrainInput = document.querySelector("input[name='custom_train_" + i + "']");
                                var hiddenInput = document.querySelector("input[name='hidden_custom_train_" + i + "']");
                                if (customTrainInput && hiddenInput) {
                                    hiddenInput.value = customTrainInput.value;
                                }
                            }
                        }
                        
                        document.getElementById('train').addEventListener('submit', function() {
                            copyTextToHiddenInputs();
                        });
                        

                        // spin wheel
                        var padding = {
                            top: 20,
                            right: 40,
                            bottom: 0,
                            left: 0
                        },
                            w = 500 - padding.left - padding.right,
                            h = 500 - padding.top - padding.bottom,
                            r = Math.min(w, h) / 2,
                            rotation = 0,
                            oldrotation = 0,
                            picked = 100000,
                            oldpick = [],
                            color = d3.scale.category20();
                        var data = [{
                            "label": "Dell LAPTOP",
                            "value": 1,
                            "question": "What CSS property is used for specifying the area between the content and its border?"
                        },
                        {
                            "label": "IMAC PRO",
                            "value": 2,
                            "question": "What CSS property is used for changing the font?"
                        },
                        {
                            "label": "SUZUKI",
                            "value": 3,
                            "question": "What CSS property is used for changing the color of text?"
                        },
                        {
                            "label": "HONDA",
                            "value": 4,
                            "question": "What CSS property is used for changing the boldness of text?"
                        },
                        {
                            "label": "FERRARI",
                            "value": 5,
                            "question": "What CSS property is used for changing the size of text?"
                        },
                        {
                            "label": "APARTMENT",
                            "value": 6,
                            "question": "What CSS property is used for changing the background color of a box?"
                        },
                        {
                            "label": "IPAD PRO",
                            "value": 7,
                            "question": "Which word is used for specifying an HTML tag that is inside another tag?"
                        },
                        {
                            "label": "LAND",
                            "value": 8,
                            "question": "Which side of the box is the third number in: margin:1px 1px 1px 1px; ?"
                        },
                        {
                            "label": "MOTOROLLA",
                            "value": 9,
                            "question": "What are the fonts that don't have serifs at the ends of letters called?"
                        },
                        {
                            "label": "BMW",
                            "value": 10,
                            "question": "With CSS selectors, what character prefix should one use to specify a class?"
                        }];
                    
                        var svg = d3.select('#chart')
                            .append("svg")
                            .data([data])
                            .attr("width", w + padding.left + padding.right)
                            .attr("height", h + padding.top + padding.bottom);
                        var container = svg.append("g")
                            .attr("class", "chartholder")
                            .attr("transform", "translate(" + (w / 2 + padding.left) + "," + (h / 2 + padding.top) + ")");
                        var vis = container
                            .append("g");
                    
                        var pie = d3.layout.pie().sort(null).value(function (d) {
                            return 1;
                        });
                        var arc = d3.svg.arc().outerRadius(r);
                        var arcs = vis.selectAll("g.slice")
                            .data(pie)
                            .enter()
                            .append("g")
                            .attr("class", "slice");
                    
                        arcs.append("path")
                            .attr("fill", function (d, i) {
                                return color(i);
                            })
                            .attr("d", function (d) {
                                return arc(d);
                            });
                    
                        arcs.append("text").attr("transform", function (d) {
                            d.innerRadius = 0;
                            d.outerRadius = r;
                            d.angle = (d.startAngle + d.endAngle) / 2;
                            return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")translate(" + (d.outerRadius - 10) + ")";
                        })
                            .attr("text-anchor", "end")
                            .text(function (d, i) {
                                return data[i].label;
                            });
                    
                        container.on("click", spin);
                    
                        function spin(d) {
                            container.on("click", null);
                            if (oldpick.length == data.length) {
                                container.on("click", null);
                                return;
                            }
                            var ps = 360 / data.length,
                                pieslice = Math.round(1440 / data.length),
                                rng = Math.floor((Math.random() * 1440) + 360);
                    
                            rotation = (Math.round(rng / ps) * ps);
                    
                            picked = Math.round(data.length - (rotation % 360) / ps);
                            picked = picked >= data.length ? (picked % data.length) : picked;
                            if (oldpick.indexOf(picked) !== -1) {
                                d3.select(this).call(spin);
                                return;
                            } else {
                                oldpick.push(picked);
                            }
                            rotation += 90 - Math.round(ps / 2);
                            vis.transition()
                                .duration(3000)
                                .attrTween("transform", rotTween)
                                .each("end", function () {
                                    d3.select(".slice:nth-child(" + (picked + 1) + ") path")
                                        .attr("fill", "#111");
                                    d3.select("#question h1")
                                        .text(data[picked].question);
                                    oldrotation = rotation;
                    
                                    console.log(data[picked].value)
                    
                                    container.on("click", spin);
                                });
                        }
                    
                        svg.append("g")
                            .attr("transform", "translate(" + (w + padding.left + padding.right) + "," + ((h / 2) + padding.top) + ")")
                            .append("path")
                            .attr("d", "M-" + (r * .15) + ",0L0," + (r * .05) + "L0,-" + (r * .05) + "Z")
                            .style({
                                "fill": "black"
                            });
                    
                        container.append("circle")
                            .attr("cx", 0)
                            .attr("cy", 0)
                            .attr("r", 60)
                            .style({
                                "fill": "white",
                                "cursor": "pointer"
                            });
                    
                        container.append("text")
                            .attr("x", 0)
                            .attr("y", 15)
                            .attr("text-anchor", "middle")
                            .text("SPIN")
                            .style({
                                "font-weight": "bold",
                                "font-size": "30px"
                            });
                    
                        function rotTween(to) {
                            var i = d3.interpolate(oldrotation % 360, rotation);
                            return function (t) {
                                return "rotate(" + i(t) + ")";
                            };
                        }
                    
                        function getRandomNumbers() {
                            var array = new Uint16Array(1000);
                            var scale = d3.scale.linear().range([360, 1440]).domain([0, 100000]);
                            if (window.hasOwnProperty("crypto") && typeof window.crypto.getRandomValues === "function") {
                                window.crypto.getRandomValues(array);
                                console.log("works");
                            } else {
                                for (var i = 0; i < 1000; i++) {
                                    array[i] = Math.floor(Math.random() * 100000) + 1;
                                }
                            }
                            return array;
                        }


                        </script>
                  </div>          
            </div>
        </div>
    </body>
  </main>
{% endblock %}
